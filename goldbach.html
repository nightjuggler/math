<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Goldbach's Conjecture</title>
<style>
body {
	background-color: white;
	font-family: verdana;
	font-size: 10pt;
}
table {
	border-collapse: collapse;
	border: 1px solid black;
}
td {
	width: 8px;
	height: 8px;
	border: 1px solid #dddddd;
}
a {text-decoration: none;}
</style>
<script>
/* globals document, setTimeout, window */
(function() {
'use strict';
// Global Constants
var firstEven = 6;
var gridHeight = 50;
var gridWidth = 60;

// Global Variables
var tableNode;
var messageText;
var maxNumber;
var primeArray;
var primeIndex;
var sumCount;
var maxSumCount;

function fillGrid()
{
	var p = primeArray[primeIndex];
	var numPrimes = primeArray.length;

	for (var i = primeIndex; i < numPrimes; ++i)
	{
		var evenNumber = p + primeArray[i];
		if (evenNumber > maxNumber) break;
		var n = (evenNumber - firstEven) / 2;

		var row = Math.floor(n / gridWidth);
		var col = n % gridWidth;

		var numSums = ++sumCount[n];
		if (numSums > maxSumCount)
			maxSumCount = numSums;

		var td = tableNode.children[row].children[col];
		td.title = evenNumber + ' (' + numSums + ')';

		var hue = Math.floor(numSums * 1.4);
		td.style.backgroundColor = 'hsl(' + hue + ',100%,50%)';
	}

	messageText.nodeValue = 'p[' + primeIndex + '] = ' + p + ', maxSumCount = ' + maxSumCount;

	if (i > primeIndex++)
		setTimeout(fillGrid, 100);
}
function getPrimes(maxNumber)
{
	const arrayLen = maxNumber + 1;
	const notPrime = new Uint8Array(arrayLen);
	const sqrt = Math.floor(Math.sqrt(maxNumber));

	for (let n = 3; n <= sqrt; n += 2)
		if (notPrime[n] === 0)
			for (let i = n * n, step = n * 2; i < arrayLen; i += step)
				notPrime[i] = 1;

	const primes = [2];
	for (let n = 3; n < arrayLen; n += 2)
		if (notPrime[n] === 0)
			primes.push(n);
	return primes;
}
function createTable(numRows, numCols, even)
{
	var table = document.createElement('table');
	for (var i = 0; i < numRows; ++i)
	{
		var tr = document.createElement('tr');
		for (var j = 0; j < numCols; ++j)
		{
			var td = document.createElement('td');
			td.title = even += 2;
			tr.appendChild(td);
		}
		table.appendChild(tr);
	}
	return table;
}
function init()
{
	tableNode = createTable(gridHeight, gridWidth, firstEven - 2);
	document.getElementById('gridContainer').appendChild(tableNode);

	messageText = document.createTextNode('');
	document.getElementById('messageDiv').appendChild(messageText);

	sumCount = new Uint16Array(gridWidth * gridHeight);
	maxSumCount = 0;
	maxNumber = firstEven - 2 + 2 * gridWidth * gridHeight;
	primeArray = getPrimes(maxNumber);
	primeIndex = 1;

	setTimeout(fillGrid, 100);
}
window.addEventListener('DOMContentLoaded', init);
})();
</script>
</head>
<body>

<a href="https://en.wikipedia.org/wiki/Goldbach%27s_conjecture">Goldbach's conjecture</a>,
<span id="messageDiv"></span>
<div id="gridContainer"></div>

</body>
</html>
